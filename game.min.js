(function(a){var d=document.getElementById("screen"),b=d.getContext("2d"),c=8,g=0,h=0,e=0,k=document.getElementById("ship"),l=k.getContext("2d");a.setPov=function(f){f=d.relMouseCoords(f);g=!1;h+=(f.x-a.width/2)*c;e+=(f.y-a.height/2)*c;f=-1;for(var b=Infinity,k=0;k<S.nodes.length;k++){var l=S.nodes[k],l=Math.sqrt((l.x-h)*(l.x-h)+(l.y-e)*(l.y-e));l<b&&(f=k,b=l)}b<50*c&&(g=S.nodes[f],h=S.nodes[f].x,e=S.nodes[f].y)};a.zoom_out=function(){c*=2};a.zoom_in=function(){c/=2};a.update_pov=function(){g&&(h=
g.x,e=g.y)};a.width=d.width;a.height=d.height;a.translate_coords=function(a,b,k){return{x:Math.floor((a-h)/c+d.width/2),y:Math.floor((b-e)/c+d.height/2),s:Math.floor(k/c+2)}};a.clear=function(){b.clearRect(0,0,d.width,d.height);l.clearRect(0,0,120,120)};a.draw_icon=function(){var f=a.translate_coords(this.x,this.y,this.size);b.drawImage(this.icon,f.x-f.s/2,f.y-f.s/2,f.s,f.s)};a.draw_star=function(){var f=a.translate_coords(this.x,this.y,this.size);b.beginPath();b.arc(f.x,f.y,2*f.s,0,2*Math.PI);var c=
b.createRadialGradient(f.x,f.y,f.s/4,f.x,f.y,2*f.s);c.addColorStop(0,"rgba("+this.color_r+", "+this.color_g+", "+this.color_b+", 0.6)");c.addColorStop(.1,"rgba("+this.color_r+", "+this.color_g+", "+this.color_b+", 0.2)");c.addColorStop(1,"rgba("+this.color_r+", "+this.color_g+", "+this.color_b+", 0.0)");b.fillStyle=c;b.fill();b.drawImage(this.icon,f.x-f.s,f.y-f.s,2*f.s,2*f.s)};a.draw_ship=function(){var c=a.translate_coords(this.x,this.y,this.size);l.translate(60,60);l.rotate(this.rotation);l.drawImage(this.icon,
-57,-46,114,92);l.rotate(-this.rotation);b.drawImage(k,c.x-10,c.y-10,20,20);l.translate(-60,-60)};a.draw_ripple=function(c){var k=a.translate_coords(c.x,c.y,0);b.strokeStyle="#aadddd";b.beginPath();b.arc(k.x,k.y,c.age,0,2*Math.PI);b.stroke();c.age+=1};a.draw_trace=function(c){c=a.translate_coords(c.x,c.y);b.fillStyle="#eeeeee";b.fillRect(c.x,c.y,1,1)}})(window.FX=window.FX||{});(function(){var a=0,d=["ms","moz","webkit","o"],b;for(b=0;b<d.length&&!window.requestAnimationFrame;b++)window.requestAnimationFrame=window[d[b]+"RequestAnimationFrame"],window.cancelAnimationFrame=window[d[b]+"CancelAnimationFrame"]||window[d[b]+"CancelRequestAnimationFrame"];window.requestAnimationFrame||(window.requestAnimationFrame=function(c,b){var d=(new Date).getTime(),e=Math.max(0,16-(d-a)),k=window.setTimeout(function(){c(d+e)},e);a=d+e;return k});window.cancelAnimationFrame||(window.cancelAnimationFrame=
function(a){clearTimeout(a)})})();function relMouseCoords(a){var d=0,b=0,c=0,g=0,c=this;do d+=c.offsetLeft-c.scrollLeft,b+=c.offsetTop-c.scrollTop;while(c=c.offsetParent);c=a.pageX-d;g=a.pageY-b;return{x:c,y:g}}HTMLCanvasElement.prototype.relMouseCoords=relMouseCoords;(function(){function a(){d.width=window.innerWidth;d.height=window.innerHeight;FX.width=d.width;FX.height=d.height}var d=document.getElementById("screen");window.addEventListener("resize",a,!1);a()})();(function(a){var d=0,b=0;arrowsPressed=function(a){38==a.keyCode&&(b=12);40==a.keyCode&&(b=-12);37==a.keyCode&&(d=-.2);39==a.keyCode&&(d=.2);return!1};arrowsReleased=function(a){38==a.keyCode&&(b=0);40==a.keyCode&&(b=0);37==a.keyCode&&(d=0);39==a.keyCode&&(d=0);return!1};a.state=function(){return{rotation:d,thrust:b}};zoom_handler=function(a){a.stopPropagation();var b=0;a||(a=window.event);a.wheelDelta?b=a.wheelDelta/60:a.detail&&(b=-a.detail/2);0>b&&FX.zoom_out();0<b&&FX.zoom_in()};a.init_controls=
function(){document.onkeydown=arrowsPressed;document.onkeyup=arrowsReleased;document.onclick=FX.setPov;window.addEventListener&&document.addEventListener("DOMMouseScroll",zoom_handler,!1);document.onmousewheel=zoom_handler}})(window.CTRL=window.CTRL||{});(function(a){function d(a,b,c,d,e){this.x=a;this.y=b;this.vx=d;this.vy=e;this.mass=c;this.size=100;this.draw=function(){};this.oncontact=function(){};return this}function b(a,b,c,g,h){a=new d(a,b,c,g,h);a.icon=new Image;a.icon.src="img/planet"+Math.floor(5*e())+".png";a.draw=FX.draw_icon;a.size=2*Math.sqrt(c);return a}function c(a,c,b,g,h){a=new d(a,c,b,g,h);a.color_r=100+Math.floor(150*e());a.color_g=100+Math.floor(150*e());a.color_b=100+Math.floor(150*e());a.icon=new Image;a.icon.src="img/star.png";
a.draw=FX.draw_star;a.size=2*Math.sqrt(b);return a}function g(a,b,c,e,g){a=new d(a,b,c,e,g);a.icon=new Image;a.icon.src="img/rocket.png";a.rotation=-Math.PI/4;a.thrust=0;a.draw=FX.draw_ship;return a}function h(b,c){var d=b.x-c.x,e=b.y-c.y,g=Math.sqrt(d*d+e*e),h=Math.sqrt(a.G*b.mass*c.mass/(g*g)*g/c.mass);c.vx=b.vx+e*h/g;c.vy=b.vy-d*h/g}a.G=20;a.nodes=[];a.masscount=0;a.shipindex=0;var e=Math.random;a.init_world=function(){a.nodes.push(new c(3200*e()-1600,3200*e()-1600,3E5,0,0));a.nodes.push(new b(a.nodes[0].x+
2500,a.nodes[0].y-1940,5E3,0,0));a.shipindex=a.nodes.length;a.nodes.push(new g(a.nodes[1].x+100,a.nodes[1].y-120,.2,0,0));h(a.nodes[0],a.nodes[1]);h(a.nodes[1],a.nodes[2]);a.masscount=a.shipindex};a.add_random_object=function(){.7<e()?a.nodes.push(new c(6400*e()-3200,6400*e()-3200,1E4+5E5*e(),100*e()-50,100*e()-50)):a.nodes.push(new b(6400*e()-3200,6400*e()-3200,1E3+1E4*e(),100*e()-50,100*e()-50))}})(window.S=window.S||{});var fpscount=document.getElementById("fps"),objcount=document.getElementById("objcount"),messages=document.getElementById("messages"),ripples=[],traces=[],frameId=NaN,dt,nextDT;function init(){dt=Date.now();nextDT=dt+200;CTRL.init_controls();S.init_world();document.getElementById("feeder").onclick=function(a){S.add_random_object();a.stopPropagation();return!1}}
function gravity(){for(var a=0;a<S.nodes.length;a++)for(var d=0;d<S.nodes.length;d++)if(a!=d){var b=S.nodes[a],c=S.nodes[d];if(!(1>=c.mass)){var g=c.x-b.x,h=c.y-b.y,e=Math.sqrt(g*g+h*h)+1,k=S.G*c.mass/(e*e*e);b.vx+=k*g;b.vy+=k*h;if(e/2>b.size+c.size)b.oncontact(c)}}}
function main_loop(){FX.clear();frameId=requestAnimationFrame(main_loop);var a=Date.now()-dt;dt=Date.now();var d=Math.ceil(200/a),a=S.nodes[S.shipindex];dt>nextDT&&(nextDT=dt+200,gravity(),a.thrust&&(a.vx+=a.thrust*Math.cos(a.rotation),a.vy+=a.thrust*Math.sin(a.rotation),ripples.unshift({x:a.x,y:a.y,age:0})),(40<ripples.length||0<ripples.length&&40<ripples[ripples.length-1].age)&&ripples.pop(),fpscount.innerHTML="FPS: "+5*d,objcount.innerHTML="Objects population: "+S.nodes.length);a.thrust&&!ripples.length&&
ripples.unshift({x:a.x,y:a.y,age:0});FX.update_pov();for(var b=0;b<ripples.length;b++)FX.draw_ripple(ripples[b]);S.nodes.forEach(function(a){a.x+=a.vx/d;a.y+=a.vy/d;a.draw()});s=CTRL.state();a.rotation+=s.rotation;a.thrust=s.thrust}window.onload=function(){init();main_loop()};
