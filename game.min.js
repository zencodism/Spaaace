(function(a){var d=document.getElementById("screen"),b=d.getContext("2d"),c=8,g=0,h=0,f=0;a.setPov=function(e){e=d.relMouseCoords(e);g=!1;h+=(e.x-a.width/2)*c;f+=(e.y-a.height/2)*c;e=-1;for(var b=Infinity,l=0;l<S.nodes.length;l++){var k=S.nodes[l],k=Math.sqrt((k.x-h)*(k.x-h)+(k.y-f)*(k.y-f));k<b&&(e=l,b=k)}b<50*c&&(g=S.nodes[e],h=S.nodes[e].x,f=S.nodes[e].y)};a.zoom_out=function(){c*=2};a.zoom_in=function(){c/=2};a.update_pov=function(){g&&(h=g.x,f=g.y)};a.width=d.width;a.height=d.height;a.translate_coords=
function(e,a,b){return{x:Math.floor((e-h)/c+d.width/2),y:Math.floor((a-f)/c+d.height/2),s:Math.floor(b/c+2)}};a.clear=function(){b.clearRect(0,0,d.width,d.height)};a.draw_icon=function(){var e=a.translate_coords(this.x,this.y,this.size);b.translate(e.x,e.y);b.drawImage(this.icon,-e.s/2,-e.s/2,e.s,e.s);b.translate(-e.x,-e.y)};a.draw_star=function(){var e=a.translate_coords(this.x,this.y,this.size);b.translate(e.x,e.y);b.beginPath();b.arc(0,0,2*e.s,0,2*Math.PI);var c=b.createRadialGradient(0,0,e.s/
4,0,0,2*e.s);c.addColorStop(0,"rgba("+this.color_r+", "+this.color_g+", "+this.color_b+", 0.6)");c.addColorStop(.1,"rgba("+this.color_r+", "+this.color_g+", "+this.color_b+", 0.2)");c.addColorStop(1,"rgba("+this.color_r+", "+this.color_g+", "+this.color_b+", 0.0)");b.fillStyle=c;b.fill();b.drawImage(this.icon,-e.s,-e.s,2*e.s,2*e.s);b.translate(-e.x,-e.y)};a.draw_ship=function(){var e=a.translate_coords(this.x,this.y,this.size);b.translate(e.x,e.y);b.rotate(this.rotation);b.drawImage(this.icon,-10,
-10,20,20);b.rotate(-this.rotation);b.translate(-e.x,-e.y)};a.draw_ripple=function(e){var c=a.translate_coords(e.x,e.y,0);b.strokeStyle="#aadddd";b.beginPath();b.arc(c.x,c.y,e.age,0,2*Math.PI);b.stroke();e.age+=1};a.draw_trace=function(e){e=a.translate_coords(e.x,e.y);b.fillStyle="#eeeeee";b.fillRect(e.x,e.y,1,1)}})(window.FX=window.FX||{});(function(){var a=0,d=["ms","moz","webkit","o"],b;for(b=0;b<d.length&&!window.requestAnimationFrame;b++)window.requestAnimationFrame=window[d[b]+"RequestAnimationFrame"],window.cancelAnimationFrame=window[d[b]+"CancelAnimationFrame"]||window[d[b]+"CancelRequestAnimationFrame"];window.requestAnimationFrame||(window.requestAnimationFrame=function(c,b){var d=(new Date).getTime(),f=Math.max(0,16-(d-a)),e=window.setTimeout(function(){c(d+f)},f);a=d+f;return e});window.cancelAnimationFrame||(window.cancelAnimationFrame=
function(a){clearTimeout(a)})})();function relMouseCoords(a){var d=0,b=0,c=0,g=0,c=this;do d+=c.offsetLeft-c.scrollLeft,b+=c.offsetTop-c.scrollTop;while(c=c.offsetParent);c=a.pageX-d;g=a.pageY-b;return{x:c,y:g}}HTMLCanvasElement.prototype.relMouseCoords=relMouseCoords;(function(){function a(){d.width=window.innerWidth;d.height=window.innerHeight;FX.width=d.width;FX.height=d.height}var d=document.getElementById("screen");window.addEventListener("resize",a,!1);a()})();(function(a){var d=0,b=0;arrowsPressed=function(a){38==a.keyCode&&(b=12);40==a.keyCode&&(b=-12);37==a.keyCode&&(d=-.2);39==a.keyCode&&(d=.2);return!1};arrowsReleased=function(a){38==a.keyCode&&(b=0);40==a.keyCode&&(b=0);37==a.keyCode&&(d=0);39==a.keyCode&&(d=0);return!1};a.state=function(){return{rotation:d,thrust:b}};zoom_handler=function(a){a.stopPropagation();var b=0;a||(a=window.event);a.wheelDelta?b=a.wheelDelta/60:a.detail&&(b=-a.detail/2);0>b&&FX.zoom_out();0<b&&FX.zoom_in()};a.init_controls=
function(){document.onkeydown=arrowsPressed;document.onkeyup=arrowsReleased;document.onclick=FX.setPov;window.addEventListener&&document.addEventListener("DOMMouseScroll",zoom_handler,!1);document.onmousewheel=zoom_handler}})(window.CTRL=window.CTRL||{});(function(a){function d(a,b,c,d,f){this.x=a;this.y=b;this.vx=d;this.vy=f;this.mass=c;this.size=100;this.draw=function(){};this.oncontact=function(){};return this}function b(a,b,c,k,g){a=new d(a,b,c,k,g);a.icon=new Image;a.icon.src="img/planet"+Math.floor(5*f())+".png";a.draw=FX.draw_icon;a.size=2*Math.sqrt(c);return a}function c(a,b,c,k,g){a=new d(a,b,c,k,g);a.color_r=100+Math.floor(150*f());a.color_g=100+Math.floor(150*f());a.color_b=100+Math.floor(150*f());a.icon=new Image;a.icon.src="img/star.png";
a.draw=FX.draw_star;a.size=2*Math.sqrt(c);return a}function g(a,b,c,f,g){a=new d(a,b,c,f,g);a.icon=new Image;a.icon.src="img/rocket.png";a.rotation=-Math.PI/4;a.thrust=0;a.draw=FX.draw_ship;return a}function h(b,c){var d=b.x-c.x,f=b.y-c.y,g=Math.sqrt(d*d+f*f),h=Math.sqrt(a.G*b.mass*c.mass/(g*g)*g/c.mass);c.vx=b.vx+f*h/g;c.vy=b.vy-d*h/g}a.G=20;a.nodes=[];a.masscount=0;a.shipindex=0;var f=Math.random;a.init_world=function(){a.nodes.push(new c(3200*f()-1600,3200*f()-1600,3E5,0,0));a.nodes.push(new b(a.nodes[0].x+
2500,a.nodes[0].y-1940,5E3,0,0));a.shipindex=a.nodes.length;a.nodes.push(new g(a.nodes[1].x+100,a.nodes[1].y-120,.2,0,0));h(a.nodes[0],a.nodes[1]);h(a.nodes[1],a.nodes[2]);a.masscount=a.shipindex}})(window.S=window.S||{});var fpscount=document.getElementById("fps"),objcount=document.getElementById("objcount"),ripples=[],traces=[],frameId=NaN,dt,nextDT;function init(){dt=Date.now();nextDT=dt+200;CTRL.init_controls();S.init_world()}function gravity(){for(var a=0;a<S.nodes.length;a++)for(var d=0;d<S.nodes.length;d++)if(a!=d){var b=S.nodes[a],c=S.nodes[d];if(!(1>=c.mass)){var g=c.x-b.x,h=c.y-b.y,f=Math.sqrt(g*g+h*h)+1,c=S.G*c.mass/(f*f*f);b.vx+=c*g;b.vy+=c*h}}}
function main_loop(){FX.clear();frameId=requestAnimationFrame(main_loop);var a=Date.now()-dt;dt=Date.now();var d=Math.ceil(200/a),a=S.nodes[S.shipindex];dt>nextDT&&(nextDT=dt+200,gravity(),a.thrust&&(a.vx+=a.thrust*Math.cos(a.rotation),a.vy+=a.thrust*Math.sin(a.rotation),ripples.unshift({x:a.x,y:a.y,age:0})),(40<ripples.length||0<ripples.length&&40<ripples[ripples.length-1].age)&&ripples.pop(),fpscount.innerHTML="FPS: "+5*d,objcount.innerHTML="Objects population: "+S.nodes.length,document.getElementById("messages").innerHTML+=
dt+"<br/>");a.thrust&&!ripples.length&&ripples.unshift({x:a.x,y:a.y,age:0});FX.update_pov();for(var b=0;b<ripples.length;b++)FX.draw_ripple(ripples[b]);S.nodes.forEach(function(a){a.x+=a.vx/d;a.y+=a.vy/d;a.draw()});s=CTRL.state();a.rotation+=s.rotation;a.thrust=s.thrust}window.onload=function(){init();main_loop()};
