(function(a){var e=document.getElementById("screen"),b=e.getContext("2d"),c=6,g=0,h=0,d=0;a.setPov=function(f){g=!1;h+=(f.x-a.width/2)*c;d+=(f.y-a.height/2)*c;f=-1;for(var b=Infinity,e=0;e<S.nodes.length;e++){var k=S.nodes[e],k=Math.sqrt((k.x-h)*(k.x-h)+(k.y-d)*(k.y-d));k<b&&(f=e,b=k)}b<50*c&&(g=S.nodes[f],h=S.nodes[f].x,d=S.nodes[f].y)};a.zoom_out=function(){c*=2};a.zoom_in=function(){c/=2};a.update_pov=function(){g&&(h=g.x,d=g.y)};a.width=e.width;a.height=e.height;a.translate_coords=function(a,
b,g){return{x:Math.floor((a-h)/c+e.width/2),y:Math.floor((b-d)/c+e.height/2),s:Math.floor(g/c+2)}};a.clear=function(){b.clearRect(0,0,e.width,e.height)};a.draw_icon=function(){var f=a.translate_coords(this.x,this.y,this.size);b.translate(f.x,f.y);b.drawImage(this.icon,-f.s/2,-f.s/2,f.s,f.s);b.translate(-f.x,-f.y)};a.draw_star=function(){var f=a.translate_coords(this.x,this.y,this.size);b.translate(f.x,f.y);b.beginPath();b.arc(0,0,2*f.s,0,2*Math.PI);var c=b.createRadialGradient(0,0,f.s/4,0,0,2*f.s);
c.addColorStop(0,"rgba("+this.color_r+", "+this.color_g+", "+this.color_b+", 0.6)");c.addColorStop(.1,"rgba("+this.color_r+", "+this.color_g+", "+this.color_b+", 0.2)");c.addColorStop(1,"rgba("+this.color_r+", "+this.color_g+", "+this.color_b+", 0.0)");b.fillStyle=c;b.fill();b.drawImage(this.icon,-f.s,-f.s,2*f.s,2*f.s);b.translate(-f.x,-f.y)};a.draw_ship=function(){var f=a.translate_coords(this.x,this.y,this.size);b.translate(f.x,f.y);b.rotate(this.rotation);b.drawImage(this.icon,-10,-10,20,20);b.rotate(-this.rotation);
b.translate(-f.x,-f.y)};a.draw_ripple=function(f){var c=a.translate_coords(f.x,f.y,0);b.strokeStyle="#aadddd";b.beginPath();b.arc(c.x,c.y,f.age,0,2*Math.PI);b.stroke();f.age+=1}})(window.FX=window.FX||{});(function(){var a=0,e=["ms","moz","webkit","o"],b;for(b=0;b<e.length&&!window.requestAnimationFrame;b++)window.requestAnimationFrame=window[e[b]+"RequestAnimationFrame"],window.cancelAnimationFrame=window[e[b]+"CancelAnimationFrame"]||window[e[b]+"CancelRequestAnimationFrame"];window.requestAnimationFrame||(window.requestAnimationFrame=function(c,b){var e=(new Date).getTime(),d=Math.max(0,16-(e-a)),f=window.setTimeout(function(){c(e+d)},d);a=e+d;return f});window.cancelAnimationFrame||(window.cancelAnimationFrame=
function(a){clearTimeout(a)})})();function relMouseCoords(a){var e=0,b=0,c=0,g=0,c=this;do e+=c.offsetLeft-c.scrollLeft,b+=c.offsetTop-c.scrollTop;while(c=c.offsetParent);c=a.pageX-e;g=a.pageY-b;return{x:c,y:g}}HTMLCanvasElement.prototype.relMouseCoords=relMouseCoords;(function(){function a(){e.width=window.innerWidth;e.height=window.innerHeight;FX.width=e.width;FX.height=e.height}var e=document.getElementById("screen");e.getContext("2d");window.addEventListener("resize",a,!1);a()})();(function(a){var e=0,b=0;arrowsPressed=function(a){38==a.keyCode&&(b=12);40==a.keyCode&&(b=-12);37==a.keyCode&&(e=-.2);39==a.keyCode&&(e=.2);return!1};arrowsReleased=function(a){38==a.keyCode&&(b=0);40==a.keyCode&&(b=0);37==a.keyCode&&(e=0);39==a.keyCode&&(e=0);return!1};a.state=function(){return{rotation:e,thrust:b}};zoom_handler=function(a){a.stopPropagation();var b=0;a||(a=window.event);a.wheelDelta?b=a.wheelDelta/60:a.detail&&(b=-a.detail/2);0>b&&FX.zoom_out();0<b&&FX.zoom_in()};a.init_controls=
function(){document.onkeydown=arrowsPressed;document.onkeyup=arrowsReleased;document.onclick=FX.setPov;window.addEventListener&&document.addEventListener("DOMMouseScroll",zoom_handler,!1);document.onmousewheel=zoom_handler}})(window.CTRL=window.CTRL||{});(function(a){function e(a,b,c,e,d){this.x=a;this.y=b;this.vx=e;this.vy=d;this.mass=c;this.size=100;this.draw=function(){};this.oncontact=function(){};return this}function b(a,b,c,k,g){a=new e(a,b,c,k,g);a.icon=new Image;a.icon.src="img/planet"+Math.floor(5*d())+".png";a.draw=FX.draw_icon;a.size=c;return a}function c(a,b,c,g,h){a=new e(a,b,c,g,h);a.color_r=100+Math.floor(150*d());a.color_g=100+Math.floor(150*d());a.color_b=100+Math.floor(150*d());a.icon=new Image;a.icon.src="img/star.png";a.draw=FX.draw_star;
a.size=2*Math.sqrt(c);return a}function g(a,b,c,d,g){a=new e(a,b,c,d,g);a.icon=new Image;a.icon.src="img/rocket.png";a.rotation=-Math.PI/4;a.thrust=0;a.draw=FX.draw_ship;return a}function h(b,c){var d=b.x-c.x,e=b.y-c.y,g=Math.sqrt(d*d+e*e),h=Math.sqrt(a.G*b.mass*c.mass/(g*g)*g/c.mass);c.vx+=e*h/g;c.vy-=d*h/g}a.G=100;a.nodes=[];a.masscount=0;a.shipindex=0;var d=Math.random;a.init_world=function(){a.nodes.push(new c(3200*d()-1600,3200*d()-1600,3E5*d(),0,0));a.nodes.push(new c(3200*d()-1600,3200*d()-
1600,1E5*d(),0,0));a.nodes.push(new b(3200*d()-1600,3200*d()-1600,200*d(),0,0));a.nodes.push(new b(3200*d()-1600,3200*d()-1600,200*d(),0,0));a.shipindex=a.nodes.length;a.nodes.push(new g(a.nodes[1].x-200,a.nodes[1].y-200,1,2,0,0));a.nodes.push(new c(3200*d()-1600,3200*d()-1600,1E5*d(),0,0));a.nodes.push(new c(3200*d()-1600,3200*d()-1600,1E5*d(),0,0));a.nodes.push(new b(3200*d()-1600,3200*d()-1600,200*d(),0,0));a.nodes.push(new b(3200*d()-1600,3200*d()-1600,200*d(),0,0));a.nodes.push(new b(3200*d()-
1600,3200*d()-1600,200*d(),0,0));h(a.nodes[0],a.nodes[1]);h(a.nodes[0],a.nodes[2]);h(a.nodes[1],a.nodes[3]);h(a.nodes[1],a.nodes[4]);a.masscount=a.shipindex}})(window.S=window.S||{});var fpscount=document.getElementById("fps"),objcount=document.getElementById("objcount"),ripples=[],frameId=NaN,dt,tprev;function init(){tprev=dt=Date.now();CTRL.init_controls();S.init_world()}function calcDV(a){if(!(0>=a.mass))for(var e=0;e<S.masscount;e++)if(a!=S.nodes[e]){var b=a,c=S.nodes[e];if(!(0>=c.mass)){var g=c.x-b.x,h=c.y-b.y,d=Math.sqrt(g*g+h*h);if(d<b.size+c.size)b.oncontact(c);else c=S.G*b.mass*c.mass/(d*d),b.lvx=b.vx,b.lvy=b.vy,b.vx+=c*g/d/b.mass,b.vy+=c*h/d/b.mass}}}
function gravity(){for(var a=0;a<S.nodes.length;a++)calcDV(S.nodes[a]);for(a=S.nodes.length-1;0<=a;a--)0>=S.nodes[a].mass&&(S.nodes.splice(a,1),S.masscount--,S.shipindex--)}
function main_loop(){FX.clear();frameId=requestAnimationFrame(main_loop);var a=Date.now()-dt;dt=Date.now();var e=Math.floor(1E3/a),a=S.nodes[S.shipindex];200<=dt-tprev&&(tprev=dt,gravity(),a.thrust&&(a.vx+=a.thrust*Math.cos(a.rotation),a.vy+=a.thrust*Math.sin(a.rotation),ripples.unshift({x:a.x,y:a.y,age:0})),(40<ripples.length||0<ripples.length&&40<ripples[ripples.length-1].age)&&ripples.pop());a.thrust&&!ripples.length&&ripples.unshift({x:a.x,y:a.y,age:0});FX.update_pov();for(var b=0;b<ripples.length;b++)FX.draw_ripple(ripples[b]);
S.nodes.forEach(function(a){a.x+=a.vx/e;a.y+=a.vy/e;a.draw()});s=CTRL.state();a.rotation+=s.rotation;a.thrust=s.thrust}window.onload=function(){init();main_loop()};
