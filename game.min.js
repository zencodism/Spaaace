(function(a){var d=document.getElementById("screen"),c=d.getContext("2d"),e=0,b=0,h=0,f=document.getElementById("ship"),g=f.getContext("2d"),k=document.getElementById("shadow"),l=k.getContext("2d"),n=new Image,p=new Image;n.src="img/shade.png";p.src="img/s_shade.png";l.translate(400,400);g.translate(100,100);a.zoom=8;a.setPov=function(m){m=d.relMouseCoords(m);e=!1;b+=(m.x-d.width/2)*a.zoom;h+=(m.y-d.height/2)*a.zoom;m=-1;for(var c=Infinity,f=0;f<LVL.nodes.length;f++){var g=LVL.nodes[f],g=Math.sqrt((g.x-
b)*(g.x-b)+(g.y-h)*(g.y-h));g<c&&(m=f,c=g)}c<50*a.zoom&&(e=LVL.nodes[m],b=LVL.nodes[m].x,h=LVL.nodes[m].y)};a.reset_pov=function(){h=b=e=0};a.zoom_out=function(){a.zoom*=2};a.zoom_in=function(){a.zoom/=2};a.update_pov=function(){e&&(b=e.x,h=e.y)};a.width=d.width;a.height=d.height;a.translate_coords=function(m,e,c){return{x:Math.round((m-b)/a.zoom+d.width/2),y:Math.round((e-h)/a.zoom+d.height/2),s:Math.round(c/a.zoom+1)}};a.clear=function(){c.clearRect(0,0,d.width,d.height);g.clearRect(-100,-100,200,
200)};a.draw_icon=function(a){l.clearRect(-400,-400,800,800);100<a.s?(l.drawImage(this.icon,-400,-400),l.rotate(-this.lightangle),l.drawImage(n,-400,-400),l.rotate(this.lightangle),c.drawImage(k,a.x-a.s/2,a.y-a.s/2,a.s,a.s)):(l.drawImage(this.s_icon,-50,-50),l.rotate(-this.lightangle),l.drawImage(p,-50,-50),l.rotate(this.lightangle),c.drawImage(k,350,350,100,100,a.x-a.s/2,a.y-a.s/2,a.s,a.s))};a.draw_gate=function(a){c.drawImage(this.icon,128*this.frame,0,128,128,a.x-a.s/2,a.y-a.s/2,a.s,a.s);this.frame++;
this.frame%=30};a.draw_star=function(a){c.beginPath();c.arc(a.x,a.y,2*a.s,0,2*Math.PI);var b=c.createRadialGradient(a.x,a.y,a.s/4,a.x,a.y,2*a.s);b.addColorStop(0,"rgba("+this.color_r+", "+this.color_g+", "+this.color_b+", 0.6)");b.addColorStop(.1,"rgba("+this.color_r+", "+this.color_g+", "+this.color_b+", 0.2)");b.addColorStop(1,"rgba("+this.color_r+", "+this.color_g+", "+this.color_b+", 0.0)");c.fillStyle=b;c.fill();c.drawImage(this.icon,a.x-a.s,a.y-a.s,2*a.s,2*a.s)};a.draw_ship=function(b){c.beginPath();
c.moveTo(b.x,b.y);c.arc(b.x,b.y,this.range/a.zoom,this.rotation-.3,this.rotation+.3);c.lineTo(b.x,b.y);var e=c.createRadialGradient(b.x,b.y,1,b.x,b.y,this.range/a.zoom);e.addColorStop(0,this.color+", 0.4)");e.addColorStop(1,this.color+", 0.0)");c.fillStyle=e;c.fill();g.rotate(this.rotation);g.drawImage(this.icon,-100,-100);g.rotate(-this.rotation);c.drawImage(f,b.x-b.s/2,b.y-b.s/2,b.s,b.s)};a.draw_ripple=function(b){var e=a.translate_coords(b.x,b.y,0);c.strokeStyle="#aadddd";c.beginPath();c.arc(e.x,
e.y,b.age,0,2*Math.PI);c.stroke();b.age+=1};a.draw_trace=function(b){b=a.translate_coords(b.x,b.y);c.fillStyle="#eeeeee";c.fillRect(b.x,b.y,1,1)};a.draw_frame=function(b){for(var e=0;e<b.length;e++){var c=a.translate_coords(b[e].x,b[e].y,b[e].size);c.x>-c.s&&c.x>-c.s&&c.x<d.width+c.s&&c.y<d.height+c.s&&b[e].draw(c)}}})(window.FX=window.FX||{});(function(){var a=0,d=["ms","moz","webkit","o"],c;for(c=0;c<d.length&&!window.requestAnimationFrame;c++)window.requestAnimationFrame=window[d[c]+"RequestAnimationFrame"],window.cancelAnimationFrame=window[d[c]+"CancelAnimationFrame"]||window[d[c]+"CancelRequestAnimationFrame"];window.requestAnimationFrame||(window.requestAnimationFrame=function(e,b){var c=(new Date).getTime(),d=Math.max(0,16-(c-a)),g=window.setTimeout(function(){e(c+d)},d);a=c+d;return g});window.cancelAnimationFrame||(window.cancelAnimationFrame=
function(a){clearTimeout(a)})})();function loadScript(a,d){var c=document.getElementsByTagName("head")[0],e=document.createElement("script");e.type="text/javascript";e.src=a;e.onreadystatechange=d;e.onload=d;c.appendChild(e)}function relMouseCoords(a){var d=0,c=0,e=0,b=0,e=this;do d+=e.offsetLeft-e.scrollLeft,c+=e.offsetTop-e.scrollTop;while(e=e.offsetParent);e=a.pageX-d;b=a.pageY-c;return{x:e,y:b}}HTMLCanvasElement.prototype.relMouseCoords=relMouseCoords;
(function(){function a(){d.width=window.innerWidth;d.height=window.innerHeight;FX.width=d.width;FX.height=d.height}var d=document.getElementById("screen");window.addEventListener("resize",a,!1);a()})();(function(a){var d=0,c=0;arrowsPressed=function(a){38==a.keyCode&&(c=10);40==a.keyCode&&(c=-10);37==a.keyCode&&(d=-.1);39==a.keyCode&&(d=.1);return!1};arrowsReleased=function(a){38==a.keyCode&&(c=0);40==a.keyCode&&(c=0);37==a.keyCode&&(d=0);39==a.keyCode&&(d=0);return!1};a.state=function(){return{rotation:d,thrust:c}};zoom_handler=function(a){a.stopPropagation();var b=0;a||(a=window.event);a.wheelDelta?b=a.wheelDelta/60:a.detail&&(b=-a.detail/2);0>b&&FX.zoom_out();0<b&&FX.zoom_in()};a.init_controls=
function(){document.onkeydown=arrowsPressed;document.onkeyup=arrowsReleased;document.onclick=FX.setPov;window.addEventListener&&document.addEventListener("DOMMouseScroll",zoom_handler,!1);document.onmousewheel=zoom_handler}})(window.CTRL=window.CTRL||{});(function(a){a.G=20;a.gravity=function(d){for(var c=0;c<d.length;c++){"planet"==d[c].type&&(d[c].farlight=Infinity);for(var e=0;e<d.length;e++)if(c!=e){var b=d[c],h=d[e],f=h.x-b.x,g=h.y-b.y,k=Math.sqrt(f*f+g*g)+1,l=a.G*h.mass/(k*k*k);b.vx+=l*f;b.vy+=l*g;if(k<b.range)b.oncontact(h);if(k<h.range)h.oncontact(b);"star"==h.type&&"planet"==b.type&&b.farlight>k&&(b.lightangle=-Math.acos(f/k),0>g&&(b.lightangle*=-1),b.farlight=k)}}};a.orbit=function(d,c){var e=d.x-c.x,b=d.y-c.y,h=Math.sqrt(e*e+b*b),f=Math.sqrt(a.G*
d.mass*c.mass/(h*h)*h/c.mass);c.vx=d.vx+b*f/h;c.vy=d.vy-e*f/h}})(window.PHYS=window.PHYS||{});(function(a){var d=Math.random,c=function(a){this.mass<a.mass||(this.vx+=a.mass/(a.mass+this.mass)*a.vx,this.vy+=a.mass/(a.mass+this.mass)*a.vy,this.mass+=a.mass,this.size+=Math.sqrt(a.size)/2,a.dying=!0,a.mass=0)},e=function(a){var c=Math.atan2(a.y-this.y,a.x-this.x);0>c&&(c+=2*Math.PI);c>this.rotation-.3&&c<this.rotation+.3?(this.color="rgba(150, 230, 150","check"==a.type&&(a.size-=5,10>a.size&&(document.getElementById("messages").innerHTML="Checkpoint cleared!",a.dead=!0))):this.color="rgba(200, 200, 200"};
a.node=function(a,c,d,e,k){this.type="node";this.x=a;this.y=c;this.vx=e;this.vy=k;this.mass=d;this.size=100;this.draw=function(){};this.oncontact=function(){};this.range=0;return this};a.planet=function(b,e,f,g,k){b=new a.node(b,e,f,g,k);b.type="planet";b.icon=new Image;b.s_icon=new Image;e=Math.floor(6*d())+".png";b.icon.src="img/planet"+e;b.s_icon.src="img/s_planet"+e;b.draw=FX.draw_icon;b.size=2*Math.sqrt(f);b.farlight=Infinity;b.lightangle=0;b.oncontact=c;b.range=2*b.size/3;return b};a.star=function(b,
e,f,g,k){b=new a.node(b,e,f,g,k);b.type="star";b.color_r=100+Math.floor(150*d());b.color_g=100+Math.floor(150*d());b.color_b=100+Math.floor(150*d());b.icon=new Image;b.icon.src="img/star.png";b.draw=FX.draw_star;b.size=2*Math.sqrt(f);b.oncontact=c;b.range=b.size/2;return b};a.ship=function(b,c,d,g,k){b=new a.node(b,c,d,g,k);b.type="ship";b.icon=new Image;b.icon.src="img/rocket.png";b.rotation=-Math.PI/4;b.thrust=0;b.draw=FX.draw_ship;b.range=1E3;b.oncontact=e;b.color="rgba(200, 200, 200";return b};
a.check=function(b,c,e,d){b=new a.node(b,c,1,e,d);b.type="check";b.icon=new Image;b.icon.src="img/sprites.png";b.draw=FX.draw_gate;b.frame=0;b.size=128;return b}})(window.ACTS=window.ACTS||{});(function(a){a.nodes=[];a.masscount=0;a.shipindex=0;var d=Math.random,c=function(a){return Math.round(Math.random()*a)};a.init_world=function(){a.nodes=[];a.nodes.push(new ACTS.star(c(3200)-1600,c(3200)-1600,3E5,0,0));a.nodes.push(new ACTS.planet(a.nodes[0].x+2500,a.nodes[0].y-1940,5E3,0,0));a.shipindex=a.nodes.length;a.nodes.push(new ACTS.ship(a.nodes[1].x+100,a.nodes[1].y-120,1,0,0));PHYS.orbit(a.nodes[0],a.nodes[1]);PHYS.orbit(a.nodes[1],a.nodes[2]);a.masscount=a.shipindex;for(var e=0;5>e;e++)a.add_checkpoint()};
a.end=function(a){cancelAnimationFrame(window.frameId);document.getElementById("messages").innerHTML="<p>"+a+"</p>";document.getElementById("log").className="extended"};a.add_checkpoint=function(){var d=a.nodes.length;a.nodes.push(new ACTS.check(c(3200)-1600,c(3200)-1600,0,0));PHYS.orbit(a.nodes[0],a.nodes[d])};a.add_random_object=function(){.7<d()?a.nodes.push(new ACTS.star(6400*d()-3200,6400*d()-3200,1E4+5E5*d(),100*d()-50,100*d()-50)):a.nodes.push(new ACTS.planet(6400*d()-3200,6400*d()-3200,1E3+
1E4*d(),100*d()-50,100*d()-50))};a.clear_dead=function(){for(var c=[],b=0,d=0;d<a.nodes.length;d++){var f=a.nodes[d];f.dying&&(f.size/=2,10>f.size&&(f.dead=!0,"star"!=f.type&&"planet"!=f.type||a.masscount--,"ship"==f.type&&a.end("Your ship was destroyed. Oops?")));f.dead||("ship"==f.type&&(a.shipindex=c.length),"check"==f.type&&b++,c.push(f))}0==b&&a.end("All checkpoints cleared. Congratulations!");a.nodes=c}})(window.LVL=window.LVL||{});var fpscount=document.getElementById("fps"),objcount=document.getElementById("objcount"),messages=document.getElementById("messages"),ripples=[],traces=[],dt,nextDT;window.frameId=NaN;
function init(){dt=Date.now();nextDT=dt+200;CTRL.init_controls();LVL.init_world();document.getElementById("feeder").onclick=function(a){LVL.add_random_object();a.stopPropagation();return!1};document.getElementById("reset").onclick=function(a){document.getElementById("log").className="";FX.reset_pov();init();main_loop();a.stopPropagation();return!1}}
function main_loop(){FX.clear();FX.update_pov();window.frameId=requestAnimationFrame(main_loop);var a=Date.now()-dt;dt=Date.now();var d=Math.ceil(200/a),a=LVL.nodes[LVL.shipindex];dt>nextDT&&(nextDT=dt+200,PHYS.gravity(LVL.nodes),LVL.clear_dead(),a.thrust&&(a.vx+=a.thrust*Math.cos(a.rotation),a.vy+=a.thrust*Math.sin(a.rotation),ripples.unshift({x:a.x,y:a.y,age:0})),(40<ripples.length||0<ripples.length&&40<ripples[ripples.length-1].age)&&ripples.pop(),fpscount.innerHTML="FPS: "+5*d,objcount.innerHTML=
"Objects population: "+LVL.nodes.length);a.thrust&&!ripples.length&&ripples.unshift({x:a.x,y:a.y,age:0});for(var c=0;c<ripples.length;c++)FX.draw_ripple(ripples[c]);FX.draw_frame(LVL.nodes);LVL.nodes.forEach(function(a){a.x+=a.vx/d;a.y+=a.vy/d});s=CTRL.state();a.rotation+=s.rotation;0>a.rotation&&(a.rotation+=2*Math.PI);a.rotation%=2*Math.PI;a.thrust=s.thrust}window.onload=function(){init();main_loop()};
